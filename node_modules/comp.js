module.exports = function comp(a,b){
	//Check basic
	if(a == b)return true;
	
	//Make sure the basic types are the same
	var at = typeof(a), bt = typeof(b);
	if(at != bt)return false;
	
	//Throw away nulls and undefineds (they'd match above if they were equal)
	if(at == "undefined" || bt == "undefined" || a == null || b == null)return false;
	
	//Check array
	if(Array.isArray(a) && Array.isArray(b)){
		if(a.length != b.length)return false;
		for(var i=0;i<a.length;++i){
			if(!comp(a[i],b[i]))return false;
		}
		return true;
	}
	
	if(a.constructor.name == "Object" && b.constructor.name == "Object"){
		for(var x in a){
			if(!(x in b))return false;
			if(!comp(a[x],b[x]))return false;
		}
		for(var x in b){
			if(!(x in a))return false;
		}
		return true;
	}
	
	if(at == "object" || at == "function"){
		var funcs = ["valueOf","toString"];
		for(var i=0;i<funcs.length;++i){
			var func = funcs[i];
			if(typeof(a[func]) == "function"
			&& typeof(b[func]) == "function"){
				var av = a[func](), bv = b[func]()
				, avt = typeof(av), bvt = typeof(bv);
				if((avt == "string" || avt == "number")
				&& (bvt == "string" || bvt == "number")) {
					return comp(av,bv);
				}
			}
		}
	}
	return false;
}
